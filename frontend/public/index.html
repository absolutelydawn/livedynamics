<!Doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>S3 CRUD Example</title>
        <style>
            .video-container {
                display: flex;
                flex-wrap: wrap;
            }
            .video-item {
                flex: 1 0 30%;
                margin: 10px;
                text-align: center;
            }
            .empty-message {
                text-align: center;
                color: gray;
            }
            #video-player-container {
                display: none;
                text-align: center;
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <h1>S3 CRUD Example</h1>
        <hr />
        <h4>File Upload (Create)</h4>
        <hr />
        <form ref='uploadForm' id='uploadForm' action='/upload' method='post' encType="multipart/form-data">
            <input type="file" name="file" />
            <input type='submit' value='Upload!' />
        </form>
        <hr />
        <h4>File List (Read, Update, Delete)</h4>
        <hr />
        <div id="video-list" class="video-container"></div>
        <p id="empty-message" class="empty-message" style="display:none;">No files uploaded yet.</p>
        <div id="video-player-container">
            <video id="video-player" width="80%" controls>
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        <script>
            function fetchFileList() {
                fetch('/list')
                    .then(response => response.json())
                    .then(data => {
                        const videoList = document.getElementById('video-list');
                        const emptyMessage = document.getElementById('empty-message');
                        videoList.innerHTML = '';
                        if (data.length === 0) {
                            emptyMessage.style.display = 'block';
                        } else {
                            emptyMessage.style.display = 'none';
                            data.forEach(item => {
                                const videoItem = document.createElement('div');
                                videoItem.className = 'video-item';
                                videoItem.innerHTML = `
                                    <p>${item.key}</p>
                                    <button onclick="playVideo('${item.url}')">Play</button>
                                    <button onclick="deleteFile('${item.key}')">Delete</button>
                                `;
                                videoList.appendChild(videoItem);
                            });
                        }
                    });
            }

            function playVideo(url) {
                const videoPlayerContainer = document.getElementById('video-player-container');
                const videoPlayer = document.getElementById('video-player');
                videoPlayer.src = url;
                videoPlayerContainer.style.display = 'block';
                videoPlayer.play();
            }

            function deleteFile(key) {
                fetch('/deleteFile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ dlKey: key })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchFileList();
                    } else {
                        alert('Failed to delete file');
                    }
                });
            }

            document.addEventListener('DOMContentLoaded', fetchFileList);
        </script>
    </body>
</html>
